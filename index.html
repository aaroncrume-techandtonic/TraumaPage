<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Overlooked Signs: Interactive Trauma Companion</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        /* Chosen Palette: Medicine Wheel Harmony */
        body { font-family: 'Inter', sans-serif; background-color: #F8FAFC; color: #1E293B; overflow: hidden; }
        
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            height: 350px;
            max-height: 400px;
            margin: 0 auto;
        }
        
        .sign-card { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); cursor: pointer; }
        .sign-card:hover { transform: translateY(-4px); box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); }
        
        .bg-east { background-color: #FEF3C7; }
        .bg-south { background-color: #FEE2E2; }
        .bg-west { background-color: #E2E8F0; }
        .bg-north { background-color: #F9FAFB; }

        @keyframes breathe {
            0%, 100% { transform: scale(1); opacity: 0.8; }
            50% { transform: scale(1.5); opacity: 0.4; }
        }
        .breathing-circle { animation: breathe 8s infinite ease-in-out; }

        .book-content h1 { @apply text-3xl font-bold mb-6 text-slate-900 border-b pb-4; }
        .book-content h2 { @apply text-2xl font-semibold mt-8 mb-4 text-slate-800; }
        .book-content p { @apply mb-4 leading-relaxed text-slate-600 text-lg; }
        .book-content strong { @apply text-slate-900; }
        
        .active-tab { @apply bg-slate-800 text-white border-l-4 border-indigo-500; }
        
        .dedication-gradient {
            background: linear-gradient(135deg, #f8fafc 0%, #e0e7ff 100%);
        }
    </style>
</head>
<body class="flex h-screen">

    <!-- Sidebar Navigation -->
    <nav class="w-20 md:w-64 bg-slate-900 text-white flex flex-col flex-shrink-0 z-20 transition-all duration-300">
        <div class="p-6 border-b border-slate-800 flex items-center gap-3">
            <div class="w-10 h-10 rounded-full border-2 border-white/20 relative overflow-hidden flex items-center justify-center bg-slate-800">
                <div class="absolute top-0 right-0 w-1/2 h-1/2 bg-yellow-400 opacity-60"></div>
                <div class="absolute bottom-0 right-0 w-1/2 h-1/2 bg-red-500 opacity-60"></div>
                <div class="absolute bottom-0 left-0 w-1/2 h-1/2 bg-slate-900 opacity-60"></div>
                <div class="absolute top-0 left-0 w-1/2 h-1/2 bg-slate-100 opacity-60"></div>
            </div>
            <span class="font-bold text-lg hidden md:block">Trauma Compass</span>
        </div>

        <div class="flex-1 py-4 space-y-1 overflow-y-auto">
            <button onclick="switchView('dashboard')" id="nav-dashboard" class="w-full flex items-center gap-4 px-6 py-4 hover:bg-slate-800 transition-colors active-tab">
                <i class="fa-solid fa-house w-6 text-center"></i>
                <span class="hidden md:block">Overview</span>
            </button>
            <button onclick="switchView('dedication')" id="nav-dedication" class="w-full flex items-center gap-4 px-6 py-4 hover:bg-slate-800 transition-colors">
                <i class="fa-solid fa-heart w-6 text-center text-rose-400"></i>
                <span class="hidden md:block">Dedication</span>
            </button>
            <button onclick="switchView('identify')" id="nav-identify" class="w-full flex items-center gap-4 px-6 py-4 hover:bg-slate-800 transition-colors">
                <i class="fa-solid fa-magnifying-glass w-6 text-center text-yellow-400"></i>
                <span class="hidden md:block">Identify (East)</span>
            </button>
            <button onclick="switchView('biology')" id="nav-biology" class="w-full flex items-center gap-4 px-6 py-4 hover:bg-slate-800 transition-colors">
                <i class="fa-solid fa-brain w-6 text-center text-red-500"></i>
                <span class="hidden md:block">Biology (South)</span>
            </button>
            <button onclick="switchView('heal')" id="nav-heal" class="w-full flex items-center gap-4 px-6 py-4 hover:bg-slate-800 transition-colors">
                <i class="fa-solid fa-seedling w-6 text-center text-slate-400"></i>
                <span class="hidden md:block">Healing (West)</span>
            </button>
            <button onclick="switchView('resources')" id="nav-resources" class="w-full flex items-center gap-4 px-6 py-4 hover:bg-slate-800 transition-colors">
                <i class="fa-solid fa-hands-holding w-6 text-center text-white"></i>
                <span class="hidden md:block">Resources (North)</span>
            </button>
        </div>

        <div class="p-4 border-t border-slate-800">
            <button onclick="toggleReader()" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white p-3 rounded-xl flex items-center justify-center gap-2 transition-all">
                <i class="fa-solid fa-book-open"></i>
                <span class="hidden md:block font-semibold">Reader Mode</span>
            </button>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="flex-1 flex flex-col min-w-0 overflow-hidden">
        <header class="h-20 bg-white border-b border-slate-200 px-8 flex items-center justify-between shadow-sm z-10">
            <div>
                <h1 id="view-title" class="text-xl font-bold text-slate-800">Series Dashboard</h1>
                <p id="view-desc" class="text-sm text-slate-500">Your roadmap from trauma to integrated healing.</p>
            </div>
            <div class="flex items-center gap-4 text-xs font-bold text-slate-400">
                <span class="flex items-center gap-2"><div class="w-3 h-3 rounded-full bg-yellow-400"></div> IDENTIFY</span>
                <span class="flex items-center gap-2"><div class="w-3 h-3 rounded-full bg-red-500"></div> UNDERSTAND</span>
                <span class="flex items-center gap-2"><div class="w-3 h-3 rounded-full bg-slate-800"></div> INTEGRATE</span>
            </div>
        </header>

        <div id="scroll-area" class="flex-1 overflow-y-auto p-8 md:p-12">
            
            <!-- Dashboard View -->
            <div id="view-dashboard" class="space-y-12">
                <div class="bg-white p-8 rounded-3xl border border-slate-200 shadow-sm max-w-4xl">
                    <h2 class="text-2xl font-bold mb-4">Welcome to the Healing Path</h2>
                    <p class="text-slate-600 leading-relaxed mb-6">
                        Trauma recovery is a journey through four quadrants. This application allows you to explore the physical signs, 
                        the neurobiology of your survival system, and the practical tools to reclaim your peace. 
                        Inspired by the Medicine Wheel, we treat healing as a holistic integration of Body, Mind, and Spirit.
                    </p>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                        <div onclick="switchView('identify')" class="p-4 rounded-2xl bg-yellow-50 border border-yellow-200 text-center cursor-pointer hover:shadow-md transition-all">
                            <div class="font-bold text-yellow-600">EAST</div>
                            <div class="text-xs text-slate-500">The Signs</div>
                        </div>
                        <div onclick="switchView('biology')" class="p-4 rounded-2xl bg-red-50 border border-red-200 text-center cursor-pointer hover:shadow-md transition-all">
                            <div class="font-bold text-red-600">SOUTH</div>
                            <div class="text-xs text-slate-500">The Brain</div>
                        </div>
                        <div onclick="switchView('heal')" class="p-4 rounded-2xl bg-slate-100 border border-slate-300 text-center cursor-pointer hover:shadow-md transition-all">
                            <div class="font-bold text-slate-700">WEST</div>
                            <div class="text-xs text-slate-500">The Tools</div>
                        </div>
                        <div onclick="switchView('resources')" class="p-4 rounded-2xl bg-white border border-slate-200 text-center cursor-pointer hover:shadow-md transition-all">
                            <div class="font-bold text-slate-400">NORTH</div>
                            <div class="text-xs text-slate-500">Support</div>
                        </div>
                    </div>
                </div>

                <div class="grid md:grid-cols-2 gap-8 max-w-6xl">
                    <div class="bg-white p-6 rounded-3xl border border-slate-200">
                        <h3 class="font-bold text-slate-800 mb-2">Trauma Spectrum Profile</h3>
                        <p class="text-xs text-slate-500 mb-4">Focus areas: Event Impact vs. Relational/Identity Impact.</p>
                        <div class="chart-container">
                            <canvas id="mainRadarChart"></canvas>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-3xl border border-slate-200 flex flex-col justify-center">
                        <h3 class="font-bold text-slate-800 mb-6 text-center">Series Progress Overview</h3>
                        <div class="space-y-6">
                            <div>
                                <div class="flex justify-between text-xs font-bold mb-2"><span>BOOK 1: SIGNS IDENTIFIED</span><span>17 / 17</span></div>
                                <div class="h-2 w-full bg-slate-100 rounded-full"><div class="h-full w-full bg-yellow-400 rounded-full"></div></div>
                            </div>
                            <div>
                                <div class="flex justify-between text-xs font-bold mb-2"><span>BOOK 2: BIOLOGY MAPPED</span><span>100%</span></div>
                                <div class="h-2 w-full bg-slate-100 rounded-full"><div class="h-full w-full bg-red-500 rounded-full"></div></div>
                            </div>
                            <div>
                                <div class="flex justify-between text-xs font-bold mb-2"><span>BOOK 3: TOOLS INTEGRATED</span><span>PROGRESSING</span></div>
                                <div class="h-2 w-full bg-slate-100 rounded-full"><div class="h-full w-2/3 bg-slate-800 rounded-full"></div></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Dedication View -->
            <div id="view-dedication" class="hidden animate-fade-in space-y-8">
                <div class="max-w-4xl mx-auto py-12 px-8 bg-white rounded-3xl border border-indigo-100 shadow-xl relative overflow-hidden">
                    <div class="absolute top-0 right-0 p-8 opacity-5 text-indigo-900"><i class="fa-solid fa-heart text-9xl"></i></div>
                    <div class="relative z-10 text-center">
                        <h2 class="text-indigo-900 text-3xl md:text-5xl font-black mb-6 tracking-tight">Dedicated to Jordan Lynn Stewart</h2>
                        <div class="w-24 h-1 bg-rose-400 mx-auto mb-8 rounded-full"></div>
                        
                        <div class="prose prose-indigo max-w-none text-slate-600 italic text-xl mb-12">
                            "A tribute to the heart that speaks the unspoken and the soul that dares to shine light into the shadows of silence."
                        </div>
                        
                        <div class="grid md:grid-cols-3 gap-6 text-left">
                            <div class="bg-indigo-50 p-6 rounded-2xl border border-indigo-100">
                                <i class="fa-solid fa-star text-indigo-600 mb-4 text-xl"></i>
                                <h4 class="font-bold text-indigo-900 mb-2">Brave Advocacy</h4>
                                <p class="text-sm text-indigo-700">Honoring the intentional steps taken to raise awareness for Complex PTSD and the strength it takes to lead others toward the light.</p>
                            </div>
                            <div class="bg-indigo-50 p-6 rounded-2xl border border-indigo-100">
                                <i class="fa-solid fa-handshake-angle text-indigo-600 mb-4 text-xl"></i>
                                <h4 class="font-bold text-indigo-900 mb-2">Cycle Breaker</h4>
                                <p class="text-sm text-indigo-700">For recognizing the hidden architecture of trauma and choosing the path of awareness over the comfort of silence.</p>
                            </div>
                            <div class="bg-indigo-50 p-6 rounded-2xl border border-indigo-100">
                                <i class="fa-solid fa-sun text-indigo-600 mb-4 text-xl"></i>
                                <h4 class="font-bold text-indigo-900 mb-2">A Beacon of Hope</h4>
                                <p class="text-sm text-indigo-700">Dedicated with love to my cousin, whose journey inspires this work and provides a roadmap for others seeking their own peace.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Identify View -->
            <div id="view-identify" class="hidden space-y-8">
                <div class="bg-yellow-50 border-l-4 border-yellow-400 p-6 rounded-r-2xl max-w-4xl">
                    <h3 class="text-yellow-800 font-bold mb-1">East: The Physical & Beginnings</h3>
                    <p class="text-sm text-yellow-700">Identification is the first act of rebellion. Click a sign to reveal the hidden logic behind the survival behavior.</p>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="signs-grid">
                    <!-- JS Injected Cards -->
                </div>
            </div>

            <!-- Biology View -->
            <div id="view-biology" class="hidden space-y-8">
                <div class="bg-red-50 border-l-4 border-red-500 p-6 rounded-r-2xl max-w-4xl">
                    <h3 class="text-red-800 font-bold mb-1">South: The Emotional Engine</h3>
                    <p class="text-sm text-red-700">Understanding the "Engine Room." See how your nervous system shifts energy to keep you alive.</p>
                </div>
                <div class="grid lg:grid-cols-2 gap-8 max-w-6xl">
                    <div class="bg-white p-8 rounded-3xl border border-slate-200">
                        <h3 class="font-bold text-slate-800 mb-4">The Polyvagal Ladder</h3>
                        <div class="chart-container">
                            <canvas id="polyvagalBarChart"></canvas>
                        </div>
                    </div>
                    <div class="bg-white p-8 rounded-3xl border border-slate-200 space-y-6">
                        <h3 class="font-bold text-slate-800">The Brain Hijack</h3>
                        <div class="p-4 rounded-xl border border-slate-100 bg-red-50">
                            <h4 class="font-bold text-red-700 text-sm">Amygdala (Smoke Detector)</h4>
                            <p class="text-xs text-red-600 mt-1">In trauma, it is hyper-sensitive, screaming "FIRE!" at the smell of burnt toast.</p>
                        </div>
                        <div class="p-4 rounded-xl border border-slate-100 bg-slate-50">
                            <h4 class="font-bold text-slate-700 text-sm">Prefrontal Cortex (The Pilot)</h4>
                            <p class="text-xs text-slate-500 mt-1">During triggers, the Pilot is kicked out of the cockpit. Logic goes offline.</p>
                        </div>
                        <div class="p-4 rounded-xl border border-slate-100 bg-indigo-50">
                            <h4 class="font-bold text-indigo-700 text-sm">Hippocampus (The Librarian)</h4>
                            <p class="text-xs text-indigo-600 mt-1">Fails to "date stamp" memories, making the past feel like it is happening NOW.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Healing View -->
            <div id="view-heal" class="hidden space-y-8">
                <div class="bg-slate-800 p-6 rounded-2xl text-white max-w-4xl">
                    <h3 class="font-bold mb-1">West: Mental & Introspection</h3>
                    <p class="text-sm text-slate-400">Healing is a daily practice. Use these tools to regulate your system when the alarm goes off falsely.</p>
                </div>
                <div class="grid md:grid-cols-2 gap-8 max-w-6xl">
                    <div class="bg-white p-12 rounded-3xl border border-slate-200 flex flex-col items-center text-center">
                        <h4 class="font-bold text-slate-800 mb-2">Paced Breathing</h4>
                        <p class="text-sm text-slate-500 mb-8">Follow the circle to activate your calm system.</p>
                        <div class="w-48 h-48 bg-indigo-50 rounded-full flex items-center justify-center relative">
                            <div class="w-24 h-24 bg-indigo-500/30 rounded-full breathing-circle"></div>
                            <span class="absolute text-indigo-800 font-bold">Breathe</span>
                        </div>
                        <div class="mt-8 grid grid-cols-3 gap-4 w-full text-xs font-bold text-slate-400">
                            <div>IN (4s)</div><div>HOLD (2s)</div><div>OUT (6s)</div>
                        </div>
                    </div>
                    <div class="bg-white p-8 rounded-3xl border border-slate-200">
                        <h4 class="font-bold text-slate-800 mb-4">5-4-3-2-1 Grounding Checklist</h4>
                        <div class="space-y-3">
                            <label class="flex items-center gap-3 p-3 bg-slate-50 rounded-xl cursor-pointer hover:bg-slate-100">
                                <input type="checkbox" class="w-5 h-5 rounded text-indigo-600"><span class="text-sm">5 Things you can see</span>
                            </label>
                            <label class="flex items-center gap-3 p-3 bg-slate-50 rounded-xl cursor-pointer hover:bg-slate-100">
                                <input type="checkbox" class="w-5 h-5 rounded text-indigo-600"><span class="text-sm">4 Things you can feel</span>
                            </label>
                            <label class="flex items-center gap-3 p-3 bg-slate-50 rounded-xl cursor-pointer hover:bg-slate-100">
                                <input type="checkbox" class="w-5 h-5 rounded text-indigo-600"><span class="text-sm">3 Things you can hear</span>
                            </label>
                            <label class="flex items-center gap-3 p-3 bg-slate-50 rounded-xl cursor-pointer hover:bg-slate-100">
                                <input type="checkbox" class="w-5 h-5 rounded text-indigo-600"><span class="text-sm">2 Things you can smell</span>
                            </label>
                            <label class="flex items-center gap-3 p-3 bg-slate-50 rounded-xl cursor-pointer hover:bg-slate-100">
                                <input type="checkbox" class="w-5 h-5 rounded text-indigo-600"><span class="text-sm">1 Thing you can taste</span>
                            </label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Resources View -->
            <div id="view-resources" class="hidden space-y-8">
                <div class="max-w-4xl">
                    <h2 class="text-3xl font-bold mb-4">North: Spiritual Wisdom & Support</h2>
                    <p class="text-slate-600 mb-8">You are not walking this path alone. Access immediate help and community resources here.</p>
                    <div id="resource-list" class="grid md:grid-cols-2 gap-4">
                        <!-- JS Injected Resources -->
                    </div>
                </div>
            </div>

        </div>
    </main>

    <!-- Reader Modal -->
    <div id="reader-modal" class="fixed inset-0 bg-slate-900/40 backdrop-blur-sm z-50 flex items-center justify-center p-4 hidden">
        <div class="bg-white w-full max-w-4xl h-[90vh] rounded-3xl shadow-2xl flex flex-col overflow-hidden">
            <header class="p-6 border-b border-slate-100 flex justify-between items-center bg-white sticky top-0">
                <div class="flex items-center gap-4">
                    <button onclick="toggleReader()" class="text-slate-400 hover:text-slate-800"><i class="fa-solid fa-xmark text-xl"></i></button>
                    <h3 class="font-bold text-slate-800">Trauma Compass Reader</h3>
                </div>
                <div class="flex items-center gap-2">
                    <div id="tts-indicator" class="hidden flex items-center gap-2 text-indigo-600 text-xs font-bold animate-pulse"><i class="fa-solid fa-waveform"></i> READING ALOUD</div>
                    <button onclick="toggleTTS()" id="tts-btn" class="flex items-center gap-2 bg-indigo-50 text-indigo-600 px-4 py-2 rounded-full font-bold text-sm hover:bg-indigo-600 hover:text-white transition-all">
                        <i class="fa-solid fa-volume-high"></i> Listen
                    </button>
                </div>
            </header>
            <div class="flex-1 overflow-y-auto p-8 md:p-16 book-content" id="reader-content">
                <!-- Book text injected here -->
            </div>
            <div id="tts-loader" class="hidden absolute inset-0 bg-white/90 z-20 flex flex-col items-center justify-center">
                <i class="fa-solid fa-circle-notch animate-spin text-4xl text-indigo-600 mb-4"></i>
                <p class="font-bold text-slate-500 uppercase text-xs tracking-widest">Generating Empathic Audio...</p>
            </div>
        </div>
    </div>

    <script>
        // Choose Palette: Medicine Wheel Harmony
        // Application Structure Plan: A 4-quadrant interactive dashboard modeled after the Medicine Wheel + Dedicated Tribute Section. 
        // User Flow: Dash -> Detail Quadrants -> Dedication -> Deep Read Modal.
        // Visualization & Content Choices: Radar (Spectrum), Bar (Biology), Grid (Signs), Animation (Breath). 
        // Confirmation: NO SVG graphics used. NO Mermaid JS used.

        const apiKey = ""; // API key managed by environment

        const signs = [
            { title: "Over-explaining", icon: "fa-comments", scenario: "Spending 20 mins drafting a basic email.", logic: "Preemptively soothing others to stay safe from unpredictable moods." },
            { title: "Preemptive Self-Attack", icon: "fa-shield-halved", scenario: "Calling yourself 'stupid' before anyone else can.", logic: "Controlling the pain of criticism by inflicting it yourself first." },
            { title: "Ignoring Needs", icon: "fa-battery-empty", scenario: "Forgetting to eat because you are focused on tasks.", logic: "Deep belief that your needs are a burden to others." },
            { title: "Validation Blocks", icon: "fa-trophy", scenario: "Praise feels like a 'mistake' or evaporates instantly.", logic: "A 'shame filter' rejects positive information about the self." },
            { title: "Apologizing for Existing", icon: "fa-user-slash", scenario: "Saying 'sorry' for taking up physical space.", logic: "Core existential shame planted by early developmental trauma." },
            { title: "Splitting", icon: "fa-arrows-split-up-and-left", scenario: "Seeing a friend as 'evil' after one missed call.", logic: "Inability to handle nuance when safety is inconsistent." },
            { title: "Hypervigilance", icon: "fa-eye", scenario: "Scanning exits in a restaurant immediately.", logic: "Nervous system permanently set to Code Red for survival." },
            { title: "Attachment Extremes", icon: "fa-magnet", scenario: "Attaching instantly or isolating completely.", logic: "Extreme management of relational risk." },
            { title: "The 'Busy' Shield", icon: "fa-person-running", scenario: "Working constantly to avoid the silence.", logic: "Outrunning intrusive memories and hollow feelings." },
            { title: "Dissociation", icon: "fa-cloud", scenario: "Checking out mid-conversation or 'losing time'.", logic: "Mental escape when physical escape was impossible." },
            { title: "Survival Cynicism", icon: "fa-filter", scenario: "Thinking 'what do they want?' when someone is nice.", logic: "Kindness historically masked betrayal." },
            { title: "Crowded Loneliness", icon: "fa-users-slash", scenario: "Feeling an invisible barrier in a group.", logic: "Unresolved shame prevents authentic connection." },
            { title: "Trauma Rehearsal", icon: "fa-film", scenario: "Imagining worst-case scenarios commute.", logic: "Practicing the pain so it won't destroy you later." },
            { title: "Emotional Freeze", icon: "fa-icicles", scenario: "Mind goes blank when asked 'how do you feel?'.", logic: "Biological disconnection from body signals." },
            { title: "Disproportionate Reaction", icon: "fa-explosion", scenario: "Rage over a dropped glass.", logic: "Reacting to stored decades of stress, not the glass." },
            { title: "Comparison Loop", icon: "fa-scale-unbalanced", scenario: "Seeing others as whole and yourself as fragments.", logic: "Internal confirmation of chronic core brokenness." },
            { title: "Repetition Compulsion", icon: "fa-rotate-right", scenario: "Dating the same hurtful type of person.", logic: "Attempting to master the old trauma by recreating the battlefield." }
        ];

        const resources = [
            { name: "National Suicide Lifeline", contact: "988", note: "Anxiety, Depression, Crisis" },
            { name: "Crisis Text Line", contact: "HOME to 741741", note: "Grief, Anxiety, Trauma" },
            { name: "Domestic Violence Hotline", contact: "1-800-799-7233", note: "Safety Planning, PTSD" },
            { name: "SAMHSA Helpline", contact: "1-800-662-4357", note: "Treatment Referral, Delusions" }
        ];

        const fullBookText = `<h1>The Hidden Language of Trauma</h1><p>Trauma is not just a memory; it is an invisible architecture that changes how you perceive safety, connection, and your own worth. It manifests as overlooked signs easily mistaken for character flaws.</p><h2>The 17 Overlooked Signs</h2><p>Identifying these signs is the first act of rebellion. <strong>Over-explaining</strong>, <strong>Preemptive Self-Attack</strong>, and <strong>Hypervigilance</strong> are not who you areâ€”they are how you survived.</p><h1>The Neurochemical Hijack</h1><p>Your brain is ultra-efficient at survival. During trauma, the <strong>Amygdala</strong> (Smoke Detector) screams at the smell of burnt toast, while the <strong>Prefrontal Cortex</strong> (The Pilot) goes offline.</p><h1>Reclaiming Your Life</h1><p>Healing happens from the bottom-up. Starting with the body using <strong>TIPP skills</strong> and <strong>Grounding</strong>, we teach the system that the danger is over.</p>`;

        let isReading = false;
        let audioContext = null;
        let currentSource = null;

        function init() {
            renderSigns();
            renderResources();
            initCharts();
        }

        function switchView(viewId) {
            document.querySelectorAll('#scroll-area > div').forEach(v => v.classList.add('hidden'));
            document.querySelectorAll('nav button').forEach(b => b.classList.remove('active-tab'));
            
            document.getElementById(`view-${viewId}`).classList.remove('hidden');
            document.getElementById(`nav-${viewId}`).classList.add('active-tab');
            
            const titles = { 
                dashboard: "Series Dashboard", 
                dedication: "The Heart of the Project",
                identify: "Identify (East)", 
                biology: "Biology (South)", 
                heal: "Healing (West)", 
                resources: "Resources (North)" 
            };
            const descs = {
                dashboard: "Your roadmap from trauma to integrated healing.",
                dedication: "Honoring the advocacy of Jordan Lynn Stewart.",
                identify: "Recognizing the physical and behavioral manifestations of trauma.",
                biology: "How the brain and nervous system adapt to survive.",
                heal: "Daily tools and strategies for retraining the survival alarm.",
                resources: "Safe harbor and emergency assistance contacts."
            };
            
            document.getElementById('view-title').textContent = titles[viewId];
            document.getElementById('view-desc').textContent = descs[viewId];
            document.getElementById('scroll-area').scrollTop = 0;
        }

        function renderSigns() {
            const grid = document.getElementById('signs-grid');
            signs.forEach(s => {
                const card = document.createElement('div');
                card.className = "bg-white p-6 rounded-3xl border border-slate-200 sign-card group";
                card.innerHTML = `<div class="w-10 h-10 rounded-xl bg-yellow-50 text-yellow-600 flex items-center justify-center mb-4"><i class="fa-solid ${s.icon}"></i></div><h4 class="font-bold mb-2">${s.title}</h4><p class="text-xs text-slate-500 hidden group-hover:block transition-all"><strong>Logic:</strong> ${s.logic}</p>`;
                grid.appendChild(card);
            });
        }

        function renderResources() {
            const list = document.getElementById('resource-list');
            resources.forEach(r => {
                list.innerHTML += `<div class="bg-white p-6 rounded-2xl border border-slate-200 flex justify-between items-center"><div><div class="font-bold text-slate-900">${r.name}</div><div class="text-xs text-slate-400 font-bold uppercase tracking-widest mt-1">${r.note}</div></div><div class="text-lg font-black text-indigo-600">${r.contact}</div></div>`;
            });
        }

        function initCharts() {
            new Chart(document.getElementById('mainRadarChart').getContext('2d'), {
                type: 'radar',
                data: {
                    labels: ['Flashbacks', 'Hypervigilance', 'Emotional Regulation', 'Self-Concept', 'Relationship Trust', 'Dissociation'],
                    datasets: [
                        { label: 'PTSD Focus', data: [90, 85, 40, 30, 40, 50], backgroundColor: 'rgba(239, 68, 68, 0.2)', borderColor: 'rgb(239, 68, 68)' },
                        { label: 'CPTSD Focus', data: [50, 70, 95, 95, 90, 80], backgroundColor: 'rgba(234, 179, 8, 0.2)', borderColor: 'rgb(234, 179, 8)' }
                    ]
                },
                options: { maintainAspectRatio: false, scales: { r: { angleLines: { display: false }, ticks: { display: false } } } }
            });

            new Chart(document.getElementById('polyvagalBarChart').getContext('2d'), {
                type: 'bar',
                data: {
                    labels: ['Ventral Vagal (Safety)', 'Sympathetic (Fight/Flight)', 'Dorsal Vagal (Freeze)'],
                    datasets: [
                        { label: 'Energy Level', data: [40, 95, 10], backgroundColor: ['#4ade80', '#ef4444', '#1e293b'] },
                        { label: 'Safety Sense', data: [95, 10, 5], backgroundColor: ['#166534', '#991b1b', '#0f172a'] }
                    ]
                },
                options: { maintainAspectRatio: false, scales: { y: { beginAtZero: true, display: false }, x: { grid: { display: false } } } }
            });
        }

        function toggleReader() {
            const modal = document.getElementById('reader-modal');
            const display = document.getElementById('reader-content');
            if (modal.classList.contains('hidden')) {
                display.innerHTML = fullBookText;
                modal.classList.remove('hidden');
            } else {
                stopTTS();
                modal.classList.add('hidden');
            }
        }

        async function toggleTTS() {
            if (isReading) { stopTTS(); return; }
            const text = document.getElementById('reader-content').innerText;
            const loader = document.getElementById('tts-loader');
            const indicator = document.getElementById('tts-indicator');
            const btn = document.getElementById('tts-btn');

            isReading = true;
            loader.classList.remove('hidden');
            indicator.classList.remove('hidden');
            btn.innerHTML = '<i class="fa-solid fa-stop"></i> Stop';
            btn.classList.add('bg-red-500');

            try {
                const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-tts:generateContent?key=${apiKey}`, {
                    method: "POST", headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: `Read with empathy: ${text.substring(0, 3000)}` }] }],
                        generationConfig: { responseModalities: ["AUDIO"], speechConfig: { voiceConfig: { prebuiltVoiceConfig: { voiceName: "Aoede" } } } },
                        model: "gemini-2.5-flash-preview-tts"
                    })
                });
                const result = await res.json();
                const pcmBase64 = result.candidates[0].content.parts[0].inlineData.data;
                playAudio(pcmBase64);
            } catch (e) { stopTTS(); } finally { loader.classList.add('hidden'); }
        }

        function stopTTS() {
            isReading = false;
            document.getElementById('tts-indicator').classList.add('hidden');
            document.getElementById('tts-loader').classList.add('hidden');
            const btn = document.getElementById('tts-btn');
            btn.innerHTML = '<i class="fa-solid fa-volume-high"></i> Listen';
            btn.classList.remove('bg-red-500');
            if (currentSource) { currentSource.stop(); currentSource = null; }
        }

        function playAudio(base64) {
            const binary = atob(base64);
            const bytes = new Uint8Array(binary.length);
            for (let i = 0; i < binary.length; i++) bytes[i] = binary.charCodeAt(i);
            const wav = createWav(bytes, 24000);
            audioContext = new (window.AudioContext || window.webkitAudioContext)();
            audioContext.decodeAudioData(wav, buffer => {
                if (!isReading) return;
                currentSource = audioContext.createBufferSource();
                currentSource.buffer = buffer;
                currentSource.connect(audioContext.destination);
                currentSource.onended = () => stopTTS();
                currentSource.start(0);
            });
        }

        function createWav(pcm, rate) {
            const buf = new ArrayBuffer(44 + pcm.length);
            const v = new DataView(buf);
            const s = (o, str) => { for (let i = 0; i < str.length; i++) v.setUint8(o + i, str.charCodeAt(i)); };
            s(0, 'RIFF'); v.setUint32(4, 36 + pcm.length, true); s(8, 'WAVE'); s(12, 'fmt '); v.setUint32(16, 16, true);
            v.setUint16(20, 1, true); v.setUint16(22, 1, true); v.setUint32(24, rate, true); v.setUint32(28, rate * 2, true);
            v.setUint16(32, 2, true); v.setUint16(34, 16, true); s(36, 'data'); v.setUint32(40, pcm.length, true);
            for (let i = 0; i < pcm.length; i++) v.setUint8(44 + i, pcm[i]);
            return buf;
        }

        window.onload = init;
    </script>
</body>
</html>
